##############################################################################
# MPPI Path Tracker Configuration for GO1 Robot
# 
# This file contains the parameters for the Model Predictive Path Integral
# (MPPI) controller used to track paths for the Unitree GO1 quadruped robot.
##############################################################################

path_tracker:
  ros__parameters:
    
    # ===========================================================================
    # MPPI Algorithm Parameters
    # ===========================================================================
    
    NX: 4                        # State dimension [x, y, velocity, yaw]
    NU: 2                        # Control input dimension [linear_vel, angular_vel]
    K: 500                       # Number of sample trajectories
    T: 30                        # Prediction horizon steps (increased for better lookahead)
    DT: 0.1                      # Time step (seconds)
    DL: 0.1                      # Distance step for path discretization

    Lam: 18.0                    # Temperature parameter (increased for smoother behavior)
    Gam: 0.95                    # Discount factor (increased to consider future costs more)

    # Covariance for sampling control inputs [linear_vel, angular_vel]
    # Keep low to prevent jerky samples
    Cov: [0.03, 0.03]

    # State cost matrix weights [x, y, velocity, yaw]
    # Reduce position tracking aggressiveness
    Q: [10.0, 10.0, 20.0, 8.0]

    # Terminal state cost matrix weights [x, y, velocity, yaw]
    Qf: [5.0, 5.0, 15.0, 8.0]

    # Control input cost matrix weights [linear_vel, angular_vel]
    # Heavily penalize both linear and angular accelerations for smoothness
    R: [2.0, 3.0]

    subgoal_cost_weight: 0.0
    velocity_cost_weight: 0.0
    heading_cost_weight: 0.0
    map_cost_weight: 0.0
    use_const: false    
    const_thres: 0.5
    tracking_thres: 5.0
    goal_thres: 0.5    
    
    # ===========================================================================
    # Path Tracking Parameters
    # ===========================================================================
    
    target_speed: 0.20           # Target forward speed (m/s) - reduced for smoother tracking
    n_ind_search: 30             # Number of indices to search for nearest path point
    tracking_thres: 5.0          # Maximum tracking error threshold (m)
    goal_thres: 0.5              # Goal reached threshold (m)
    
    preserved_path: true         # Keep path after goal is reached
    
    # ===========================================================================
    # Path Smoothing Parameters
    # ===========================================================================
    
    Regressor_Type: "Spline"     # Path regressor type: Poly | Spline | SmoothSpline | PenalizedBSpline
    Order: 1                     # Regressor order
    Lamb: 0.0001                 # Smoothing parameter
    Window: 10                   # Window size for local regression
    Knot: 9                      # Number of knots for spline
    
    # ===========================================================================
    # Robot Physical Parameters (Unitree GO1)
    # ===========================================================================
    
    width: 0.5708                # Robot width (m) - affects turning radius
    wheelRadius: 0.1785          # Effective wheel radius (m)
    wheelBase: 0.512             # Distance between front and rear (m)
    
    maxLinVel: 0.35              # Maximum linear velocity (m/s) - reduced for stability
    maxAngVel: 0.50              # Maximum angular velocity (rad/s) - reduced to prevent collapse
    
    # ===========================================================================
    # Coordinate Frames
    # ===========================================================================
    
    frame_id: map                # Global map frame ID
    
    # ===========================================================================
    # ROS Topics
    # ===========================================================================
    
    # Localization
    localization_topic: "/go1_pose"              # Robot pose input
    
    # Path Planning
    local_path_topic: "/local_path"              # Path to follow
    
    # Map topic
    cost_map_topic: "/map"

    # Control Output
    cmd_ctrl_topic: "/cmd_vel"                   # Velocity command output
    cmd_ctrl_stamped_topic: "/cmd_vel_stamped"   # Stamped velocity command
    enable_stamped_cmd_vel: true                 # Use stamped velocity messages
    
    # ===========================================================================
    # Visualization and Debugging
    # ===========================================================================
    
    num_vis: 50                  # Number of sample trajectories to visualize
    verbose: false               # Enable verbose logging
    vis_segment: true            # Visualize path segments
    vis_reference: true          # Visualize reference trajectory
    vis_candidate: true          # Visualize candidate trajectories
    vis_poly: true               # Visualize polynomial fits
    vis_subgoal: true            # Visualize subgoal
    debug_cost: false            # Enable cost debugging output
    preserved_path: true         # True when the passed path remains undeleted
    reconfigure: true            # True when the parameters are reconfigured